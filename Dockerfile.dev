# Development Dockerfile with hot reload

FROM node:22-alpine AS base
RUN apk add --no-cache libc6-compat curl
WORKDIR /app

# Install dependencies
COPY package*.json ./
COPY core/package*.json ./core/
COPY gateway/package*.json ./gateway/
COPY workers/embeddings/package*.json ./workers/embeddings/
COPY web/package*.json ./web/

RUN npm install

# Development stage for Gateway
FROM base AS gateway-dev
WORKDIR /app/gateway
EXPOSE 3000
EXPOSE 9229
CMD ["npm", "run", "dev"]

# Development stage for Embeddings Worker
FROM base AS worker-dev
WORKDIR /app/workers/embeddings
CMD ["npm", "run", "dev"]

# Development stage for Web Client
FROM base AS web-dev
WORKDIR /app/web
EXPOSE 3001
CMD ["npm", "run", "dev"]